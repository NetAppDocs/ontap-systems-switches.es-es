---
permalink: other-procedures/replace-switches-with-direct-connections.html 
sidebar: sidebar 
keywords: transition, switchless, cluster, two, node, direct, connections 
summary: Puede sustituir los switches de un clúster de dos nodos por conexiones directas de vuelta a atrás entre los nodos. 
---
= Sustituya los interruptores por conexiones directas
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


Si tiene un clúster de dos nodos que utiliza switches de interconexión de clúster, reemplace los switches por conexiones directas de vuelta a respaldo entre los nodos. Esta operación no es disruptiva.

.Antes de empezar
* El clúster debe estar en buen estado y tener dos nodos conectados mediante switches del clúster, y los nodos deben ejecutar la misma versión de ONTAP.
* Cada nodo debe tener el número requerido de puertos de clúster dedicados que proporcionan conexiones redundantes de interconexión de clúster para admitir la configuración del sistema, por ejemplo, dos puertos redundantes para un sistema con dos puertos dedicados de interconexión de clúster en cada nodo.


.Acerca de esta tarea
En el siguiente procedimiento, se quitan los switches de clúster de dos nodos y se reemplaza cada conexión al switch por una conexión directa al nodo compañero.

image::../media/tnsc_clusterswitches_and_direct_connections.PNG[Los switches del clúster se reemplazaron por conexiones directas]

Los ejemplos del siguiente procedimiento muestran nodos que utilizan «e0a» y «e0b» como puertos del clúster. Sus nodos pueden usar distintos puertos de clúster según varían según el sistema.

.Pasos
. Cambie el nivel de privilegio a Advanced, introduzca `y` cuando se le solicite continuar:
+
`set -privilege advanced`

+
El aviso avanzado `*>` aparece.

. ONTAP 9.3 y versiones posteriores admiten la detección automática de clústeres sin switch, que está habilitado de forma predeterminada.
+
Puede verificar que la detección de clústeres sin switch esté habilitada mediante el comando de privilegio avanzado:

+
`network options detect-switchless-cluster show`

+
El siguiente resultado de ejemplo muestra si la opción está habilitada.

+
[listing]
----
cluster::*> network options detect-switchless-cluster show
   (network options detect-switchless-cluster show)
Enable Switchless Cluster Detection: true
----
+
Si la opción "Activar detección de clústeres sin switch" está en `false`, póngase en contacto con el servicio de asistencia

. Si se habilita AutoSupport en este clúster, elimine la creación automática de casos invocando un mensaje de AutoSupport:
+
`system node autosupport invoke -node * -type all -message MAINT=<number_of_hours>h`

+
donde `h` es la duración del plazo de mantenimiento en horas. El mensaje notifica al soporte técnico de esta tarea de mantenimiento para que estos puedan impedir la creación automática de casos durante la ventana de mantenimiento.

+
En el ejemplo siguiente, el comando suprime la creación automática de casos durante dos horas:

+
[listing]
----
cluster::*> system node autosupport invoke -node * -type all -message MAINT=2h
----
. Organice los puertos del clúster en cada switch en grupos de modo que los puertos del clúster en group1 vayan a Cluster switch1 y los puertos del cluster en group2 vayan a cluster switch2. Estos grupos son necesarios más adelante en el procedimiento.
. Identificar los puertos del clúster y verificar el estado y el estado del enlace:
+
`network port show -ipspace Cluster`

+
En el siguiente ejemplo, en el caso de nodos con puertos de clúster "e0a" y "e0b", un grupo se identifica como “1:e0a” y “2:e0a” y el otro grupo como “1:e0b” y “2:e0b”. Sus nodos pueden usar puertos de clúster diferentes porque varían según el sistema.

+
image::../media/tnsc_clusterswitch_connections.PNG[Conexiones del switch de clúster entre los nodos 1 y 2]

+
Compruebe que los puertos tienen un valor de `up` Para la columna “Link” y un valor de `healthy` Para la columna "Estado de salud", como se muestra en el ejemplo siguiente:

+
[listing]
----
cluster::> network port show -ipspace Cluster
Node: node1
                                                                 Ignore
                                             Speed(Mbps) Health  Health
Port  IPspace   Broadcast Domain Link  MTU   Admin/Oper	 Status  Status
----- --------- ---------------- ----- ----- ----------- ------- -------
e0a   Cluster   Cluster          up    9000  auto/10000  healthy false
e0b   Cluster   Cluster          up    9000  auto/10000  healthy false

Node: node2
                                                                 Ignore
                                             Speed(Mbps) Health  Health
Port  IPspace   Broadcast Domain Link  MTU   Admin/Oper	 Status  Status
----- --------- ---------------- ----- ----- ----------- ------- -------
e0a   Cluster   Cluster          up    9000  auto/10000  healthy false
e0b   Cluster   Cluster          up    9000  auto/10000  healthy false
4 entries were displayed.
----
. Confirmar que todas las LIF de clúster están en sus puertos raíz.
+
Compruebe que la columna "es-home" es `true` Para cada LIF del clúster:

+
`network interface show -vserver Cluster -fields is-home`

+
El sistema muestra un resultado similar al siguiente ejemplo:

+
[listing]
----
cluster::*> net int show -vserver Cluster -fields is-home
(network interface show)
vserver  lif          is-home
-------- ------------ --------
Cluster  node1_clus1  true
Cluster  node1_clus2  true
Cluster  node2_clus1  true
Cluster  node2_clus2  true
4 entries were displayed.
----
+
Si hay LIF de clúster que no estén en sus puertos raíz, revierte estos LIF a sus puertos principales:

+
`network interface revert -vserver Cluster -lif *`

. Deshabilite la reversión automática para las LIF del clúster:
+
`network interface modify -vserver Cluster -lif * -auto-revert false`

. Compruebe que todos los puertos enumerados en el paso anterior están conectados a un conmutador de red:
+
`network device-discovery show -port _cluster_port_`

+
La columna “dispositivo detectado” debe ser el nombre del conmutador de clúster al que está conectado el puerto. En el siguiente ejemplo se muestra que los puertos de clúster «e0a» y «e0b» están conectados correctamente a los switches del clúster «cs1» y «cs2».

+
[listing]
----
cluster::> network device-discovery show -port e0a|e0b
  (network device-discovery show)
Node/     Local  Discovered
Protocol  Port   Device (LLDP: ChassisID)  Interface  Platform
--------- ------ ------------------------- ---------- ----------
node1/cdp
          e0a    cs1                       0/11       BES-53248
          e0b    cs2                       0/12       BES-53248
node2/cdp
          e0a    cs1                       0/9        BES-53248
          e0b    cs2                       0/9        BES-53248
4 entries were displayed.
----
. Compruebe la conectividad del clúster:
+
`cluster ping-cluster -node local`

. Compruebe que el clúster esté en buen estado:
+
`cluster ring show`

+
Todas las unidades deben ser maestra o secundaria.

. Configure la configuración sin switches para los puertos del grupo 1.
+

IMPORTANT: Para evitar posibles problemas de red, debe desconectar los puertos del grupo 1 y volver a conectarlos lo antes posible, por ejemplo, *en menos de 20 segundos*.

+
.. Desconecte todos los cables de los puertos del grupo 1 al mismo tiempo.
+
En el ejemplo siguiente, los cables se desconectan del puerto "e0a" en cada nodo, y el tráfico del clúster continúa a través del switch y el puerto "e0b" en cada nodo:

+
image::../media/tnsc_clusterswitch1_disconnected.PNG[ClusterSwitch1 desconectado]

.. Conecte los puertos en group1 de vuelta a espalda.
+
En el siguiente ejemplo, "e0a" en el nodo 1 está conectado a "e0a" en el nodo 2:

+
image::../media/tnsc_ports_e0a_direct_connection.PNG[Conexión directa entre los puertos "e0a"]



. La opción de red de clúster sin switch desde la transición `false` para `true`. Esto puede tardar hasta 45 segundos. Confirme que la opción sin switches está establecida en `true`:
+
`network options switchless-cluster show`

+
En el siguiente ejemplo se muestra que el clúster sin switch está habilitado:

+
[listing]
----
cluster::*> network options switchless-cluster show
Enable Switchless Cluster: true
----
. Compruebe que la red de clúster no se haya interrumpido:
+
`cluster ping-cluster -node local`

. Configure la configuración sin switches para los puertos del grupo 2.
+

IMPORTANT: Para evitar posibles problemas de red, debe desconectar los puertos del grupo 2 y volver a conectarlos lo antes posible, por ejemplo, *en menos de 20 segundos*.

+
.. Desconecte todos los cables de los puertos del grupo 2 al mismo tiempo.
+
En el ejemplo siguiente, los cables se han desconectado del puerto "e0b" en cada nodo y el tráfico del clúster continúa por la conexión directa entre los puertos "e0a":

+
image::../media/tnsc_clusterswitch2_disconnected.PNG[ClusterSwitch2 desconectado]

.. Conecte los puertos en group2 de vuelta a back.
+
En el ejemplo siguiente, hay conectado "e0a" en el nodo 1 a "e0a" en el nodo 2 y "e0b" en el nodo 1 está conectado a "e0b" en el nodo 2:

+
image::../media/tnsc_node1_and_node2_direct_connection.PNG[Conexión directa entre los puertos del nodo 1 y el nodo 2]



. Compruebe que los puertos de ambos nodos están conectados correctamente:
+
`network device-discovery show -port _cluster_port_`

+
En el siguiente ejemplo se muestra que los puertos de clúster «e0a» y «e0b» están conectados correctamente al puerto correspondiente del partner de clúster:

+
[listing]
----
cluster::> net device-discovery show -port e0a|e0b
  (network device-discovery show)
Node/      Local  Discovered
Protocol   Port   Device (LLDP: ChassisID)  Interface  Platform
---------- ------ ------------------------- ---------- ----------
node1/cdp
           e0a    node2                     e0a        AFF-A300
           e0b    node2                     e0b        AFF-A300
node1/lldp
           e0a    node2 (00:a0:98:da:16:44) e0a        -
           e0b    node2 (00:a0:98:da:16:44) e0b        -
node2/cdp
           e0a    node1                     e0a        AFF-A300
           e0b    node1                     e0b        AFF-A300
node2/lldp
           e0a    node1 (00:a0:98:da:87:49) e0a        -
           e0b    node1 (00:a0:98:da:87:49) e0b        -
8 entries were displayed.
----
. Vuelva a habilitar la reversión automática para las LIF del clúster:
+
`network interface modify -vserver Cluster -lif * -auto-revert true`

. Compruebe que todas las LIF son Home. Esto puede tardar unos segundos:
+
`network interface show -vserver Cluster -lif _lif_name_`

+
Los LIF se han revertido si la columna “es de inicio” es `true`, como se muestra para `node1_clus2` y.. `node2_clus2` en el siguiente ejemplo:

+
[listing]
----
cluster::> network interface show -vserver Cluster -fields curr-port,is-home
vserver  lif           curr-port is-home
-------- ------------- --------- -------
Cluster  node1_clus1   e0a       true
Cluster  node1_clus2   e0b       true
Cluster  node2_clus1   e0a       true
Cluster  node2_clus2   e0b       true
4 entries were displayed.
----
+
Si alguna de las LIF de clúster no ha vuelto a sus puertos raíz, revierte manualmente:

+
`network interface revert -vserver Cluster -lif _lif_name_`

. Compruebe el estado del clúster de los nodos desde la consola del sistema de cualquier nodo:
+
`cluster show`

+
En el siguiente ejemplo se muestra épsilon en ambos nodos que desee `false`:

+
[listing]
----
Node  Health  Eligibility Epsilon
----- ------- ----------- --------
node1 true    true        false
node2 true    true        false
2 entries were displayed.
----
. Confirme la conectividad entre los puertos del clúster:
+
`cluster ping-cluster local`

. Si ha suprimido la creación automática de casos, rehabilitarla invocando un mensaje de AutoSupport:
+
`system node autosupport invoke -node * -type all -message MAINT=END`

. Vuelva a cambiar el nivel de privilegio a admin:
+
`set -privilege admin`



*Información relacionada*

link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Software/ONTAP_OS/How_to_suppress_automatic_case_creation_during_scheduled_maintenance_windows_-_ONTAP_9["Artículo de la base de conocimientos de NetApp 1010449: Cómo impedir la creación automática de casos durante las ventanas de mantenimiento programado"^]
